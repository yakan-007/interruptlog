# InterruptLog Slim - 使い方ガイド

現行コードベースに対応した最新版。タスク・割り込み・休憩をタイムトラッキングし、データは IndexedDB にローカル保存（オフライン可）。

## アプリの構成
- **ログ（ホーム）**: マイタスク管理、タイマー開始/停止、割り込み・休憩の記録、押し忘れ追加、履歴編集。
- **レポート**: 日/週/月/年のダッシュボード。ハイライト、時間配分、タスクフロー、割り込みインサイト。
- **設定**: テーマ、自動開始、予定時間/期限入力、並び順、カテゴリ管理、割り込みプリセット、期限アラート、データ保持、インポート/エクスポート、全データ削除。
- 下部ナビ（`ログ / レポート / 設定`）と、実行中のみ出るフローティング操作パネル。

## ログ画面の使い方
- **マイタスク**
  - 追加時にカテゴリ（有効時）や予定時間・期限（「予定時間と期限」ON 時）を入力可能。
  - ドラッグで並べ替え（「納期が近い順」ON の間は無効）。完了トグルでアーカイブ／復元／削除。
  - 「追加してすぐ開始」「リストの上に追加」は設定で切替。
  - 実行中カードは経過時間と、実績 vs 予定／期限までのチップを表示。
- **開始・停止**
  - どのタスクを開始しても直前の実行中イベントは自動で終了。
  - 実行中はフローティング操作（停止・割り込み・休憩）。タスク停止時は紐付けタスクを完了扱いにする選択肢あり。
- **割り込み**
  - タスク実行中にバーから開始すると即プレースホルダーが走り、経過が正確に記録される。
  - 件名、発信者、カテゴリ（6種ラベル/色を設定可）、緊急度、保存済みの相手/件名チップで高速入力。
  - 動作:  
    - **保存して再開**: 割り込みを保存し、直前タスクを新イベントとして再開。  
    - **保存して終了**: 保存のみで再開しない。  
    - **キャンセル**: 割り込みを破棄。経過があれば「未分類の時間」を追加してタスク再開。
- **休憩**
  - バーから開始すると即休憩イベント開始（タイプ＋任意の予定分数）。
  - **保存して再開**で前タスク再開、**保存して終了**で終了のみ、**キャンセル**で休憩を破棄してタスク再開。
- **押し忘れを追加**
  - モーダルで開始/終了を指定してタスク・割り込み・休憩を後から作成。重複は自動チェック。
  - カテゴリ、紐付けタスク、割り込み項目、休憩タイプ/予定分数、メモを付与。保存済みの割り込みテンプレートも利用。
- **履歴編集**
  - フィルタ（今日 / 今日+昨日 / 1週間 / すべて）。行内編集で種別・ラベル・メモ・カテゴリ・紐付けタスク・割り込み項目・休憩タイプを変更。
  - 「終了時刻を調整」で終了日時を移動。短縮時は任意名のギャップイベントを作成可。編集中に種別/カテゴリ/割り込みカテゴリ変更も可。

## レポート
- 粒度切替: 日/週/月/年 + 日付ピッカー。
- サマリーカード、ハイライト、割り込み統計、時間帯・曜日トレンド、週次アクティビティ、タスクフロー、カテゴリ別スタック、日次詳細表（「日」選択時）。
- タスク台帳のスナップショット（予定/期限/カテゴリの変化を反映）と実イベントログを併用。

## 設定とカスタマイズ
- **外観**: ライト/ダーク切替。
- **タスクの扱い**: 自動開始、予定時間/期限入力の表示切替、追加位置、納期順ソート。
- **分類**: タスクカテゴリの有効/無効、追加・編集・削除（色設定）。
- **割り込みの定型**: 6カテゴリ名の変更、よく登場する相手/件名テンプレート（各10件）管理。
- **期限アラート**: 警告/危険のしきい値プリセット（計画チップに反映）。
- **データ管理**:
  - 保持期間（なし/1週/1か月/3か月/6か月/1年）、自動クリーンアップ、対象件数を見てワンクリック削除。
  - JSON エクスポート/インポート（events と My Tasks を置換し、稼働中タイマーをリセット）。全データ削除ボタンあり。

## データモデルとエクスポート
- idb-keyval 経由で IndexedDB にローカル保存。サーバ同期なし。
- エクスポート/インポート（設定 → データ管理）のペイロード:
  ```json
  {
    "events": [ ... ],
    "myTasks": [ ... ]
  }
  ```
- `events` 主なフィールド: `id`, `type: task|interrupt|break`, `label?`, `start`, `end?`, `categoryId?`, `meta.myTaskId?`, `meta.planningSnapshot?`, `meta.isUnknownActivity?`, `who?`, `interruptType?`, `urgency?`, `breakType?`, `breakDurationMinutes?`, `memo?`.
- `myTasks` 主なフィールド: `id`, `name`, `isCompleted`, `order`, `categoryId?`, `planning? { plannedDurationMinutes?, dueAt? }`, `createdAt`, `completedAt?`, `canceledAt?`.

## コツ
- 割り込みの相手/件名テンプレをこまめに更新すると入力が速い。
- 履歴を上書きせず「押し忘れを追加」と終了時刻調整＋ギャップ作成で整合性を保つ。
- 期限重視なら「納期順ソート」＋計画チップを ON、手動ドラッグ重視なら OFF。  
